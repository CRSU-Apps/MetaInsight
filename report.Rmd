---
title: "MetaInsight report"
output: html_document

params:
  axis: NA
  bayes: NA
  bugsnetdt: NA
  data: NA
  excluded: NA
  exclusionbox: NA
  forest: NA
  freq_all: NA
  freq_sub: NA
  label: NA
  metaoutcome: NA
  modelranfix: NA
  netgraph_label: NA
  outcome_measure: NA
  ranking: NA
  reference_alter: NA
---

```{r include = FALSE}
library(knitr)

```

### User inputs and selections

**Outcome type**  
Continuous (mean difference) or binary (odds ratio)

```{r}
params$metaoutcome
```

**Study data and treatment labels**

```{r}
params$data

treatment_label(params$label)
```

**Outcome measure**  
Mean difference (MD) or standardised mean difference (SMD) for continuous data  
Odds ratio (OR), risk ratio (RR) or risk difference (RD) for binary data  

```{r}
params$outcome_measure
```

For treatment rankings, smaller outcome values (e.g. smaller mean values for continuous data, or ORs less than 1 for binary data) are desirable (good) or undesirable (bad)

```{r}
params$ranking
```

**Model**  
Random effect (RE) or fixed effect (FE)

```{r}
params$modelranfix
```

**Excluded studies**

```{r}
paste(params$excluded, collapse = (", "))
```

### MetaInsight app outputs

**Data used for NMA**

```{r}
knitr::kable(params$data)
```


#### 1. Data summary

##### 1a. Data characteristics

**Characteristics table of all studies**

```{r}
summary_table_plot(params$bugsnetdt, params$metaoutcome)
```

**Characteristics table with studies excluded**

```{r}
summary_table_plot(filter(params$bugsnetdt, !Study %in% params$exclusionbox), params$metaoutcome)
```

##### 1b. Study results  

**Individual study results (for all studies) grouped by treatment comparison**

```{r}
make_netStudy(params$freq_sub, params$outcome_measure, params$forest$ForestHeader, params$forest$ForestTitle)
```

##### 1c. Network plot  

**Network plot of all studies**

Number of trials shown on the line

```{r}
make_netgraph(params$freq_all, params$netgraph_label$label_all)
```

Number of trials indicated by node size and line thickness

```{r}
make_netplot(params$bugsnetdt, params$netgraph_label$label_all)
```

Network connectivity

```{r}
make_netconnect(params$freq_all)
```

**Network plot with studies excluded**   

Number of trials shown on the line

```{r}
make_netgraph(params$freq_sub, params$netgraph_label$label_excluded)
```

Number of trials indicated by node size and line thickness

```{r}
make_netplot(filter(params$bugsnetdt, !Study %in% params$exclusionbox), params$netgraph_label$label_all)
```

Network connectivity

```{r}
make_netconnect(params$freq_sub)
```

#### 2. Frequentist network meta-analysis

##### 2a. Forest plot 

**Results for all studies**

```{r}
make_netComp(params$freq_all, params$modelranfix, params$reference_alter$ref_all, params$axis$freqmin, params$axis$freqmax)

texttau(params$freq_all, params$outcome_measure, params$modelranfix)

make_refText(params$reference_alter$ref_all)
```

**Results with studies excluded**

```{r}
make_netComp(params$freq_sub, params$modelranfix, params$reference_alter$ref_sub, params$axis$freqmin_sub, params$axis$freqmax_sub)

texttau(params$freq_sub, params$outcome_measure, params$modelranfix)

make_refText(params$reference_alter$ref_sub)
```

##### 2b. Comparison of all treatment pairs

**Relative treatment effects in ranked order for all studies**

```{r}
make_netrank(params$freq_all, params$modelranfix, params$ranking)
```

**Relative treatment effects in ranked order with studies excluded**

```{r}
make_netrank(params$freq_sub, params$modelranfix, params$ranking)
```


##### 2c. Inconsistency

**Assessment of inconsistency for all studies**

```{r}
make_Incon(params$freq_all, params$modelranfix)
```

**Assessment of inconsistency with studies removed**

```{r}
make_Incon(params$freq_sub, params$modelranfix)
```

#### 3. Bayesian Network Meta-analysis

##### 3a. Forest plot 

**Forest plot for all studies**
<!-- {r eval = (params$bayes != 0)} -->

```{r}
make_Forest(params$bayes$model, params$metaoutcome, params$bayes$bayesmin, params$bayes$bayesmax)
```

DIC table 

```{r}
knitr::kable(params$bayes$model$dic, digits=3)

gemtctau(params$bayes$model, params$outcome_measure)
```


**Forest plot with studies excluded**

```{r}
make_Forest(params$bayes$model_sub, params$metaoutcome, params$bayes$bayesmin_sub, params$bayes$bayesmax_sub)
```

DIC table 

```{r}
knitr::kable(params$bayes$model_sub$dic, digits=3)

gemtctau(params$bayes$model_sub, params$outcome_measure)

```



